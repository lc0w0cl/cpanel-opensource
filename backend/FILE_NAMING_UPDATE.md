# 文件命名优化说明

## 更新概述

已优化文件上传功能，现在文件命名会包含导航项名称，让文件更有辨识度。

## 新的文件命名规则

### 命名格式
```
[导航项名称]_[时间戳]_[UUID].扩展名
```

### 示例
- 原来：`20241222_143025_a1b2c3d4.png`
- 现在：`百度搜索_20241222_143025_a1b2c3d4.png`
- 现在：`GitHub_20241222_143026_b2c3d4e5.jpg`

## 名称清理规则

为确保文件名安全和兼容性，导航项名称会经过以下处理：

1. **空格替换**：空格替换为下划线
   - `Google 搜索` → `Google_搜索`

2. **特殊字符移除**：只保留字母、数字、中文、下划线、连字符
   - `GitHub (代码托管)` → `GitHub_代码托管`
   - `Stack Overflow!` → `Stack_Overflow`

3. **连续下划线合并**：多个连续下划线合并为一个
   - `My___Site` → `My_Site`

4. **长度限制**：导航项名称部分限制在20个字符内
   - `这是一个非常长的导航项目名称` → `这是一个非常长的导航项目名称`（截取前20字符）

5. **默认名称**：如果清理后为空，使用默认名称 `nav`
   - `!!!@@@` → `nav_20241222_143025_a1b2c3d4.png`

## 代码修改

### 1. FileUploadService 接口
添加了新的重载方法：
```java
/**
 * 上传文件到本地服务器（包含导航项名称）
 * @param file 上传的文件
 * @param navigationName 导航项名称，用于文件命名
 * @return 文件访问URL
 */
String uploadFile(MultipartFile file, String navigationName);
```

### 2. FileUploadServiceImpl 实现
- 实现了新的 `uploadFile` 重载方法
- 添加了 `generateUniqueFileName` 重载方法
- 新增了 `sanitizeFileName` 方法用于清理文件名

### 3. NavigationItemController 控制器
修改了创建和更新方法，传递导航项名称：
```java
// 创建时
String logoUrl = fileUploadService.uploadFile(logoFile, request.getName());

// 更新时
logoUrl = fileUploadService.uploadFile(logoFile, request.getName());
```

## 兼容性

- **向后兼容**：原有的 `uploadFile(MultipartFile file)` 方法仍然可用
- **渐进式升级**：新功能不影响现有代码
- **安全性**：文件名清理确保跨平台兼容性

## 测试示例

### 测试用例 1：中文名称
- 导航项名称：`百度搜索`
- 生成文件名：`百度搜索_20241222_143025_a1b2c3d4.png`

### 测试用例 2：英文名称
- 导航项名称：`GitHub`
- 生成文件名：`GitHub_20241222_143025_a1b2c3d4.png`

### 测试用例 3：包含特殊字符
- 导航项名称：`Stack Overflow!`
- 清理后：`Stack_Overflow`
- 生成文件名：`Stack_Overflow_20241222_143025_a1b2c3d4.png`

### 测试用例 4：超长名称
- 导航项名称：`这是一个非常长的导航项目名称用于测试文件命名功能`
- 清理后：`这是一个非常长的导航项目名称用于测试文件命名功能`（截取前20字符）
- 生成文件名：`这是一个非常长的导航项目名称用于测试文件命名功能_20241222_143025_a1b2c3d4.png`

### 测试用例 5：特殊字符名称
- 导航项名称：`!!!@@@###`
- 清理后：`nav`（使用默认名称）
- 生成文件名：`nav_20241222_143025_a1b2c3d4.png`

## 优势

1. **更好的辨识度**：通过文件名就能知道是哪个导航项的图标
2. **便于管理**：在文件系统中更容易找到和管理文件
3. **调试友好**：开发和维护时更容易定位问题
4. **安全可靠**：文件名清理确保跨平台兼容性
5. **向后兼容**：不影响现有功能

## 注意事项

1. **文件名长度**：虽然有长度限制，但在某些文件系统中仍需注意总长度
2. **字符编码**：确保文件系统支持UTF-8编码的文件名
3. **重复名称**：时间戳和UUID确保即使导航项名称相同也不会冲突
4. **清理规则**：如需调整清理规则，可修改 `sanitizeFileName` 方法

## 部署建议

1. **测试环境验证**：先在测试环境验证新的文件命名功能
2. **备份现有文件**：部署前备份现有的上传文件
3. **监控日志**：部署后监控文件上传相关日志
4. **渐进式迁移**：可以考虑为现有文件添加重命名功能（可选）
